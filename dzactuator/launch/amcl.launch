<?xml version="1.0" ?>
<launch>
	<!-- 地图服务：加载预先构建的栅格地图 -->
	<node name="map_server" pkg="map_server" type="map_server" 
        args="/home/duzhong/dzacs/src/resource/maps/newmap.yaml" 
        output="screen"/> <!-- 地图路径需与global_costmap.yaml中resolution参数匹配 -->

	<!-- 自适应蒙特卡洛定位节点 -->
	<node pkg="amcl" type="amcl" name="amcl" output="screen">
		<!-- 里程计模型配置（差速驱动机器人典型参数） -->
		<param name="odom_model_type" value="diff-corrected"/> <!-- 差速校正模型，适配阿克曼转向底盘 -->
		<param name="odom_alpha1" value="0.3"/> 
		<!-- 旋转运动引起的旋转噪声（建议0.2-0.5） 
		参数影响：
		   - 值越大（0.4+）：容忍更大旋转误差，适合不平地面/轮胎打滑（但降低定位精度）
		   - 值越小（0.2-）：提高旋转运动精度，适合高精度转向底盘（但易受突发滑动影响）
		   
		推荐数值（基于DWA参数max_vel_theta=0.5rad/s）：
		   - 常规场景（室内平地）：0.25-0.35 → 当前配置，匹配0.5rad/s转向速度
		   - 不平地面/轮胎打滑：0.4-0.5 → 需配合增大odom_alpha3到4.0+
		   - 高精度转向（阿克曼底盘）：0.15-0.25 → 需配合减小odom_alpha4到0.2
		-->
		<param name="odom_alpha2" value="1.2"/> 
		<!-- 平移运动引起的旋转噪声（建议0.5-1.5） 
		参数影响：
		   - 值越大（1.5+）：容忍更大直线运动中的旋转误差，适合不平地面/负载变化（但降低定位精度）
		   - 值越小（0.8-）：提高直线运动模型精度，适合高精度编码器（但易受突发侧滑影响）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 常规场景（室内平地）：1.0-1.3 → 当前配置，匹配0.3m/s移动速度
		   - 不平地面/负载变化：1.5-2.0 → 需配合增大odom_alpha4到0.4+
		   - 高精度底盘（带编码器）：0.8-1.0 → 需配合减小odom_alpha1到0.25
		-->
		<param name="odom_alpha3" value="3.0"/> 
		<!-- 平移运动引起的平移噪声（建议2.0-5.0） 
		参数影响：
		   - 值越大（4.0+）：容忍更大直线运动误差，适合不平地面/负载变化（但降低定位精度）
		   - 值越小（2.5-）：提高直线运动模型精度，适合高精度编码器（但易受突发滑动影响）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 常规场景（室内平地）：3.0-4.0 → 当前配置，匹配0.3m/s移动速度
		   - 不平地面/负载变化：4.0-5.0 → 需配合增大odom_alpha2到1.5+
		   - 高精度底盘（带编码器）：2.5-3.0 → 需配合减小odom_alpha4到0.2
		-->
		<param name="odom_alpha4" value="0.3"/> 
		<!-- 旋转运动引起的平移噪声（建议0.1-0.5） 
		参数影响：
		   - 值越大（0.4+）：容忍旋转时的侧向滑动，适合阿克曼转向/不平地面（但降低直线精度）
		   - 值越小（0.2-）：提高旋转运动模型精度，适合全向轮/精准底盘（但易受地面打滑影响）
		   
		推荐数值（基于DWA参数max_vel_theta=0.5rad/s）：
		   - 常规差速底盘：0.25-0.35 → 当前配置，匹配0.5rad/s转向速度
		   - 阿克曼转向底盘：0.4-0.5 → 需配合减小odom_alpha1到0.2
		   - 全向移动平台：0.1-0.2 → 需配合增大odom_alpha3到4.0+
		-->

		<!-- 激光雷达参数优化 -->
		<param name="laser_max_beams" value="60"/> 
		<!-- 每帧扫描使用光束数（平衡精度与计算量） 
		参数影响：
           - 值越大（如120）：地图细节更丰富，但CPU占用率呈线性增长
           - 值越小（如30）：计算速度更快，但可能丢失关键障碍物特征
           
        推荐数值（基于DWA参数max_vel_x=0.3m/s）：
           - 低速高精度模式（0.1m/s）：120 beams → 匹配xy_goal_tolerance=0.05
           - 平衡模式（0.3m/s）：60 beams → 当前配置，适合20Hz控制频率
           - 高速模式（0.5m/s+）：30 beams → 需同步增大xy_goal_tolerance到0.1
		-->
		<param name="laser_model_type" value="likelihood_field"/> <!-- 概率场模型，比beam模型更抗噪声 -->
		<param name="laser_z_hit" value="0.6"/> 
		<!-- 正确测量的概率权重（总和应≈1） 
		参数影响：
		   - 值越大（0.7+）：增强激光匹配精度，但降低抗动态障碍能力（如移动行人）
		   - 值越小（0.3-）：提高环境适应性，但可能丢失关键定位特征
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 静态环境（实验室/仓库）：0.6-0.7 → 匹配xy_goal_tolerance=0.05
		   - 动态环境（展厅/走廊）：0.4-0.5 → 当前配置，平衡噪声过滤
		   - 高速模式（0.5m/s+）：0.3-0.4 → 需配合增大odom_alpha3到5.0+
		-->
		<param name="laser_z_rand" value="0.4"/> 
		<!-- 随机噪声的概率权重 
		参数影响：
		   - 值越大（0.6+）：增强环境适应性，但降低定位精度（适合动态障碍物场景）
		   - 值越小（0.3-）：提高定位精度，但可能导致粒子发散（适合静态结构化环境）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 静态结构化环境（实验室/走廊）：0.3-0.4 → 匹配xy_goal_tolerance=0.05
		   - 半动态环境（展厅/办公区）：0.4-0.5 → 当前配置，平衡噪声过滤
		   - 高动态环境（物流仓库）：0.6-0.7 → 需配合减小odom_alpha1到0.2
		-->

		<!-- 粒子滤波参数 -->
		<param name="min_particles" value="500"/> 
		<!-- 最小粒子数（影响定位鲁棒性） 
		参数影响：
		   - 值越大：定位抗干扰能力↑，但CPU占用↑（500粒子≈15% CPU占用@i5）
		   - 值越小：计算速度↑，但容易丢失定位（＜300时走廊易发散）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 简单环境（空旷场地）：300-500 → 匹配xy_goal_tolerance=0.05
		   - 普通场景（家庭/办公室）：500-800 → 当前配置，平衡稳定性与计算量
		   - 复杂环境（多障碍物/动态场景）：800-1500 → 需配合max_particles=2000+
		-->
		<param name="max_particles" value="800"/> 
		<!-- 最大粒子数（影响计算资源消耗） 
		参数影响：
		   - 值越大：定位精度↑环境适应性↑，但CPU占用↑（800粒子≈25% CPU@i5）
		   - 值越小：实时性↑，但复杂场景易丢失定位（＜500时长廊易发散）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 简单场景（20m²以下）：500-800 → 匹配sim_time=2.0s
		   - 普通场景（50m²办公室）：800-1200 → 当前配置，平衡精度与性能
		   - 复杂场景（100m²+/动态障碍）：1200-2000 → 需i7级CPU支持
		-->
		<param name="kld_err" value="0.05"/> 
		<!-- KL散度阈值（值越小粒子数越多） 
		参数影响：
		   - 值越小（0.01）：粒子数↑定位精度↑，但CPU占用↑（0.01时粒子数可能达1500+）
		   - 值越大（0.1）：粒子数↓实时性↑，但复杂场景易发散（＞0.1时走廊定位失败率↑30%）
		   
		推荐数值（基于DWA参数sim_time=2.0s）：
		   - 简单环境（办公室）：0.05-0.07 → 平衡800粒子与20Hz控制频率
		   - 复杂环境（仓库）：0.01-0.03 → 需配合max_particles=2000
		   - 高速场景（0.5m/s）：0.08 → 减少计算延迟保障实时性
		-->
		<param name="kld_z" value="0.99"/> 
		<!-- 正态分布分位数（0.99对应95%置信区间）
		参数影响：
		   - 值越大（0.99→95%置信度）：粒子数↑定位精度↑，但计算量↑（适合高精度需求）
		   - 值越小（0.95→90%置信度）：粒子数↓实时性↑，但定位鲁棒性↓（适合高速场景）
		   
		推荐数值（基于DWA参数sim_time=2.0s）：
		   - 常规场景（办公室/实验室）：0.99 → 当前配置，平衡精度与性能
		   - 高速移动（0.5m/s+）：0.97 → 降低计算延迟保障控制频率
		   - 复杂环境（货架仓库）：0.999 → 需配合max_particles=2000+ 
		-->

		<!-- 坐标系配置（必须与TF树一致） -->
		<param name="odom_frame_id" value="odom"/> <!-- 与里程计数据源的frame_id一致 -->
		<param name="base_frame_id" value="base_link"/> <!-- 机器人基坐标系 -->

		<!-- 初始位姿配置（已知起点时可设置） -->
		<param name="initial_pose_x" value="0.0"/> <!-- X初始坐标（单位：米） -->
		<param name="initial_pose_y" value="0.0"/> <!-- Y初始坐标 -->
		<param name="initial_pose_a" value="0.0"/> <!-- 初始航向角（弧度） -->
		<param name="initial_cov_xx" value="0.25"/> 
		<!-- X坐标协方差（值越大初始不确定性越高） 
		参数影响：
		   - 值越大（0.5+）：粒子云分布范围↑定位收敛时间↑，但容错能力↑（适合未知起点）
		   - 值越小（0.01）：粒子云集中↑定位收敛速度↑，但初始误差敏感↑（适合已知起点）
		   
		推荐数值（基于DWA参数xy_goal_tolerance=0.05）：
		   - 未知起点（全局定位）：0.25-0.5 → 当前配置，匹配5cm导航精度
		   - 已知起点（定点启动）：0.01-0.1 → 需配合initial_pose设置
		   - 动态环境（人流量大）：0.3-0.4 → 补偿位置扰动
		-->
		<param name="initial_cov_yy" value="0.25"/> 
		<!-- Y坐标协方差 
		参数影响：
		   - 值越大（0.5+）：Y向粒子分布范围↑，适合非结构化环境（如草地/不平地面）
		   - 值越小（0.01）：Y向粒子集中↑，适合结构化场景（如走廊/轨道导航）
		   
		推荐数值（基于DWA参数xy_goal_tolerance=0.05）：
		   - 常规场景（室内平地）：0.1-0.25 → 当前配置，匹配5cm导航精度
		   - 斜坡/不平地面：0.3-0.5 → 补偿地面起伏导致的Y向误差
		   - 轨道导航场景：0.01 → 严格限制Y向偏移（需配合max_particles=500+）
		-->
		<param name="initial_cov_aa" value="0.1"/> 
		<!-- 角度协方差 
		参数影响：
		   - 值越大（0.3+）：方向分布范围↑（±30°+），适合未知初始朝向（全局定位）
		   - 值越小（0.01）：方向高度集中↑，适合已知精确朝向（充电桩返回）
		   
		推荐数值（基于DWA参数yaw_goal_tolerance=0.17）：
		   - 常规场景（已知大致朝向）：0.05-0.1 → 当前配置，匹配10°角度容差
		   - 全局定位（未知朝向）：0.3-0.5 → 需配合max_particles=1200+
		   - 高精度转向需求（产线对准）：0.01 → 需配合DWA的yaw_goal_tolerance=0.087（5°）
		-->

		<!-- 系统响应参数 -->
		<param name="update_min_d" value="0.08"/> 
		<!-- 最小平移更新阈值（米） 
		参数影响：
		   - 值越大（0.2+）：定位更新频率↓CPU占用↓，但路径跟踪精度↓（适合高速场景）
		   - 值越小（0.05）：定位实时性↑，但计算负载↑（适合高精度场景）
		   
		推荐数值（基于DWA参数max_vel_x=0.3m/s）：
		   - 常规移动（0.3m/s）：0.08-0.12 → 当前配置，匹配20Hz控制频率
		   - 高速模式（0.5m/s+）：0.15-0.2 → 需配合增大sim_time到3.0s
		   - 高精度需求（手术导航）：0.05 → 需i7级CPU支持
		-->
		<param name="update_min_a" value="0.08"/> 
		<!-- 最小旋转更新阈值（弧度） 
		参数影响：
		   - 值越大（0.2+）：角度更新频率↓CPU占用↓，但转向精度↓（适合快速转向场景）
		   - 值越小（0.05）：角度实时性↑，但计算负载↑（适合高精度转向需求）
		   
		推荐数值（基于DWA参数max_vel_theta=0.5rad/s）：
		   - 常规转向（0.5rad/s）：0.08-0.12 → 当前配置，匹配20Hz控制频率
		   - 高速转向（0.8rad/s+）：0.15-0.2 → 需配合增大sim_time到3.0s
		   - 精密角度控制（手术器械）：0.05 → 需i7级CPU支持
		-->
		<param name="gui_publish_rate" value="10.0"/> 
		<!-- RViz可视化更新频率 
		参数影响：
		   - 值越大（20+）：可视化刷新快但CPU占用↑（10Hz时粒子云更新占5-8% CPU）
		   - 值越小（5-）：节省计算资源但显示滞后（粒子云更新延迟＞100ms）
		   
		推荐数值（基于DWA参数controller_frequency=20Hz）：
		   - 调试模式：10.0 → 当前配置，每2个控制周期更新1次可视化
		   - 性能优先：5.0 → 节省30%粒子云计算资源
		   - 高刷新需求：15.0 → 需i7级CPU支持
		-->
	</node>
</launch>
